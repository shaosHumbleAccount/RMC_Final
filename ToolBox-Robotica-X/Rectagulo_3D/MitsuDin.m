function Qpp=MitsuDin(u)

q1=u(1);
q2=u(2);
q3=u(3);

q1p=u(4);
q2p=u(5);
q3p=u(6);

Q=[q1;q2;q3];
Qp=[q1p;q2p;q3p];

% IDq=[Dq1;Dq2;Dq3];
% 
% I111=0.001;
% I121=0.002;
% I131=0.003;
% 
% I221=0.002;
% I231=0.003;

I331=0.003;

I112=0.001;
I122=0.002;
I132=0.003;

I222=0.002;
I232=0.003;

I332=0.003;

I113=0.001;
I123=0.002;
I133=0.003;

I223=0.002;
I233=0.003;

I333=0.003;

l1=2.5;
% l2=1.6;
% h1=1.74;
l11=1.25;
l21=0.8;

%m1=2.0;
m2=1.5;
m3=2.0;

g=9.81;


M(1,1)=I331+(cos(q2+q3))*(I223*(cos(q2+q3))+I123*(sin(q2+q3)))+(sin(q2+q3))*(I123*(cos(q2+q3))+I113*(sin(q2+q3)))+(cos (q2))*(I112*(cos (q2))-I122*(sin (q2)))-(sin (q2))*(I122*(cos (q2))-I222*(sin (q2)))+m3*(l1*(sin (q1))*(sin (q2))-l21*(cos (q2))*(cos (q3))*(sin (q1))+l21*(sin (q1))*(sin (q2))*(sin (q3)))^2+m2*l11^2*(cos(q1))*(cos(q1))*(sin(q2))*(sin(q2))+m2*l11^2*(sin(q1))*(sin(q1))*(sin(q2))*(sin(q2))+m3*((-l1)*(cos(q1))*(sin(q2))+l21*(cos(q1))*(cos(q2))*(cos(q3))-l21*(cos (q1))*(sin (q2))*(sin (q3)))^2;
M(1,2)=I132*(cos(q2))-I232*(sin (q2))+I233*(cos(q2+q3))+I133*(sin(q2+q3));
M(1,3)=I233*(cos(q2+q3))+I133*(sin(q2+q3));

M(2,1)=I132*(cos(q2))-I232*(sin(q2))+I233*(cos(q2+q3))+I133*(sin(q2+q3));
M(2,2)=I332+I333+2*l1*m3*l21*(sin(q3))+l1*l1*m3+m2*l11*l11+m3*l21*l21;
M(2,3)=I333+l1*m3*l21*(sin(q3))+m3*l21*l21;

M(3,1)=I233*(cos(q2+q3))+I133*(sin(q2+q3));
M(3,2)=I333+l1*m3*l21*(sin(q3))+m3*l21*l21;
M(3,3)=I333+m3*l21*l21;

C(1,1)=(1/2)*q3p*(l1*m3*l21*(cos(q3))-l1*m3*l21*(cos((2*q2)+q3))+2*I123*(cos(2*q2+2*q3))+I113*(sin(2*q2+2*q3))-I223*(sin(2*q2+2*q3))-m3*l21*l21*(sin(2*q2+2*q3)))+(1/2)*q2p*(I222*(sin(2*q2))-I112*(sin(2*q2))-2*I122*(cos(2*q2))-2*l1*m3*l21*(cos((2*q2)+(q3)))+l1*l1*m3*(sin(2*q2))+m2*l11*l11*(sin(2*q2))+2*I123*(cos((2*q2)+(2*q3)))+I113*(sin((2*q2)+(2*q3)))-I223*(sin((2*q2)+(2*q3)))-m3*l21*l21*(sin((2*q2)+(2*q3)))); 
C(1,2)=(1/2)*q3p*(2*I133*(cos(q2+q3))-2*I233*(sin(q2+q3)))+(1/2)*q2p*(2*I133*(cos(q2+q3))-2*I132*(sin (q2))-2*I232*(cos(q2))-2*I233*(sin(q2+q3)))+(1/2)*q1p*(I222*(sin(2*q2))-I112*(sin(2*q2))-2*I122*(cos(2*q2))-2*l1*m3*l21*(cos(2*q2+q3))+l1*l1*m3*(sin(2*q2))+m2*l11*l11*(sin(2*q2))+2*I123*(cos(2*q2+2*q3))+I113*(sin(2*q2+2*q3))-I223*(sin(2*q2+2*q3))-m3*l21*l21*(sin(2*q2+2*q3)));
C(1,3)=(1/2)*q2p*(2*I133*(cos(q2+q3))-2*I233*(sin(q2+q3)))+(1/2)*q3p*(2*I133*(cos(q2+q3))-2*I233*(sin(q2+q3)))+(1/2)*q1p*(l1*m3*l21*(cos(q3))-l1*m3*l21*(cos((2*q2)+q3))+2*I123*(cos((2*q2)+(2*q3)))+I113*(sin((2*q2)+(2*q3)))-I223*(sin((2*q2)+(2*q3)))-m3*l21*l21*(sin((2*q2)+(2*q3))));

C(2,1)=(1/2)*q1p*(2*I122*(cos(2*q2))+I112*(sin(2*q2))-I222*(sin(2*q2))+2*l1*m3*l21*(cos((2*q2)+q3))-l1*l1*m3*(sin(2*q2))-m2*l11*l11*(sin(2*q2))-2*I123*(cos((2*q2)+(2*q3)))-I113*(sin((2*q2)+(2*q3)))+I223*(sin((2*q2)+(2*q3)))+m3*l21*l21*(sin((2*q2)+(2*q3))));
C(2,2)=l1*m3*l21*q3p*(cos(q3));
C(2,3)=l1*m3*l21*q2p*(cos(q3))+l1*m3*l21*q3p*(cos(q3));

C(3,1)=(1/2)*q1p*(l1*m3*l21*(cos((2*q2)+q3))-l1*m3*l21*(cos(q3))-2*I123*(cos((2*q2)+(2*q3)))-I113*(sin((2*q2)+(2*q3)))+I223*(sin((2*q2)+(2*q3)))+m3*l21*l21*(sin((2*q2)+(2*q3))));
C(3,2)=-l1*m3*l21*q2p*(cos(q3));
C(3,3)=0;

G(1,1)=0;
G(2,1)=-g*l1*m3*(sin(q2))-g*m2*l11*(sin(q2))+g*m3*l21*(cos(q2+q3));
G(3,1)=g*m3*l21*(cos(q2+q3));

tao(1,1)=u(7);
tao(2,1)=u(8);
tao(3,1)=u(9);

Tao=[tao(1,1);tao(2,1);tao(3,1)];

Qpp=inv(M)*(Tao-C*Qp-G);

